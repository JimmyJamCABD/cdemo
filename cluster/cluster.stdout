Load balancer config:
----------------
# This file is generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc.
global
	maxconn 256
	external-check

defaults
	timeout connect 5000ms
	timeout client 50000ms
	timeout server 50000ms

frontend f_conjur_master_http
	mode tcp
	bind *:443
	default_backend b_conjur_master_http

frontend f_conjur_master_pg
	mode tcp
	bind *:5432
	default_backend b_conjur_master_pg

frontend f_conjur_master_ldap
	mode tcp
	bind *:636
	default_backend b_conjur_master_ldap

# HTTP backend info 
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc
backend b_conjur_master_http
	mode tcp
	balance static-rr
	option external-check
	default-server inter 5s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server cdemo_conjur_node_3 172.18.0.8:443 check
	 server cdemo_conjur_node_2 172.18.0.7:443 check
	 server cdemo_conjur_node_1 172.18.0.2:443 check

# PG backend info
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc
backend b_conjur_master_pg
	mode tcp
	balance static-rr
	option external-check
	default-server inter 5s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server cdemo_conjur_node_3 172.18.0.8:5432 check
	 server cdemo_conjur_node_2 172.18.0.7:5432 check
	 server cdemo_conjur_node_1 172.18.0.2:5432 check

# LDAP backend info 
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc
backend b_conjur_master_ldap
	mode tcp
	balance static-rr
	option external-check
	default-server inter 30s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server cdemo_conjur_node_3 172.18.0.8:636 check
	 server cdemo_conjur_node_2 172.18.0.7:636 check
	 server cdemo_conjur_node_1 172.18.0.2:636 check


Running containers:
----------------
cdemo_conjur_node_3		Up About a minute
cdemo_conjur_node_2		Up About a minute
cdemo_scope_1		Up 3 minutes
conjur_follower		Up 4 minutes
cdemo_cli_1		Up 4 minutes
conjur_master		Up 1 second
cdemo_conjur_node_1		Up 6 minutes
artifacturlweb_app_1		Up 2 hours


Stateful node info:
----------------
cdemo_conjur_node_3, standby, 172.18.0.8
cdemo_conjur_node_2, standby, 172.18.0.7
cdemo_conjur_node_1, master, 172.18.0.2


~/Conjur/cdemo/cluster >> ./1-trigger-failover.sh 

-----
Checking if Conjur version supports failover...

-----
Configuring etcd cluster manager and cluster policy...
Logged in
Create policy role 'conjur/cluster/dev'
Create policy resource 'conjur/cluster/dev'
Create layer 'conjur/cluster/dev'
Create host 'conjur/cluster/dev/cdemo_conjur_node_3'
Create host 'conjur/cluster/dev/cdemo_conjur_node_2'
Create host 'conjur/cluster/dev/cdemo_conjur_node_1'
Grant layer 'conjur/cluster/dev' to host 'conjur/cluster/dev/cdemo_conjur_node_3'
Grant layer 'conjur/cluster/dev' to host 'conjur/cluster/dev/cdemo_conjur_node_2'
Grant layer 'conjur/cluster/dev' to host 'conjur/cluster/dev/cdemo_conjur_node_1'
{"dev:host:conjur/cluster/dev/cdemo_conjur_node_3":"e053ty343epk4xgqah6ysdmbn299z94t3qy9rk32ssxenecs3g9b","dev:host:conjur/cluster/dev/cdemo_conjur_node_2":"3yaks29194d5m22jqw97x2em645q2g8n0zw7qdp76228cd4r3aayy16","dev:host:conjur/cluster/dev/cdemo_conjur_node_1":"23027zrh353dv3sp2hf52xyb2bd3zy55ta2mzrkaw1s5emj44yj55m"}

-----
Enrolling Conjur nodes with cluster manager...
error: Unknown option -a

NAME
    enroll - Enroll this node in the named Conjur cluster

SYNOPSIS
    evoke [global options] cluster enroll [command options] cluster-name

COMMAND OPTIONS
    -n, --cluster-machine-name=name - Name for this machine in the cluster
                                      (default: 1b3de23dad45)
~/Conjur/cdemo/cluster >> vi 1-trigger-failover.sh 
~/Conjur/cdemo/cluster >> ./1-trigger-failover.sh 

-----
Checking if Conjur version supports failover...

-----
Configuring cluster management...
Logged in
{}

-----
Enrolling Conjur nodes with cluster manager...
error: Received extra command arguments
~/Conjur/cdemo/cluster >> vi 1-trigger-failover.sh 
~/Conjur/cdemo/cluster >> ./1-trigger-failover.sh 

-----
Checking if Conjur version supports failover...

-----
Configuring cluster management...
Logged in
{}

-----
Enrolling Conjur nodes with cluster manager...
[2017-12-22T17:10:21+00:00] INFO: *** Chef 10.34.6 ***
[2017-12-22T17:10:21+00:00] WARN: Run List override has been provided.
[2017-12-22T17:10:21+00:00] WARN: Original Run List: []
[2017-12-22T17:10:21+00:00] WARN: Overridden Run List: [recipe[conjur::cluster]]
[2017-12-22T17:10:21+00:00] INFO: Run List is [recipe[conjur::cluster]]
[2017-12-22T17:10:21+00:00] INFO: Run List expands to [conjur::cluster]
[2017-12-22T17:10:21+00:00] INFO: Starting Chef Run for 1b3de23dad45
[2017-12-22T17:10:21+00:00] INFO: Running start handlers
[2017-12-22T17:10:21+00:00] INFO: Start handlers complete.
[2017-12-22T17:10:21+00:00] WARN: Cloning resource attributes for service[etcd-proxy] from prior resource (CHEF-3694)
[2017-12-22T17:10:21+00:00] WARN: Previous service[etcd-proxy]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:21+00:00] WARN: Current  service[etcd-proxy]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:21+00:00] WARN: Cloning resource attributes for service[etcd] from prior resource (CHEF-3694)
[2017-12-22T17:10:21+00:00] WARN: Previous service[etcd]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:21+00:00] WARN: Current  service[etcd]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:21+00:00] WARN: Cloning resource attributes for service[cluster] from prior resource (CHEF-3694)
[2017-12-22T17:10:21+00:00] WARN: Previous service[cluster]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:21+00:00] WARN: Current  service[cluster]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:21+00:00] INFO: Processing template[/opt/conjur/etc/conjur.conf] action create (conjur::_conjur_conf line 1)
[2017-12-22T17:10:21+00:00] INFO: template[/opt/conjur/etc/conjur.conf] backed up to /var/chef/backup/opt/conjur/etc/conjur.conf.chef-20171222171021
[2017-12-22T17:10:21+00:00] INFO: template[/opt/conjur/etc/conjur.conf] updated content
[2017-12-22T17:10:21+00:00] INFO: template[/opt/conjur/etc/conjur.conf] owner changed to 999
[2017-12-22T17:10:21+00:00] INFO: template[/opt/conjur/etc/conjur.conf] group changed to 999
[2017-12-22T17:10:21+00:00] INFO: template[/opt/conjur/etc/conjur.conf] mode changed to 644
[2017-12-22T17:10:21+00:00] INFO: Processing service[etcd-proxy] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:23+00:00] INFO: service[etcd-proxy] enabled
[2017-12-22T17:10:23+00:00] INFO: Processing service[etcd-proxy] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:23+00:00] INFO: Processing service[etcd] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:28+00:00] INFO: service[etcd] enabled
[2017-12-22T17:10:28+00:00] INFO: Processing service[etcd] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:28+00:00] INFO: Processing service[cluster] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:33+00:00] INFO: service[cluster] enabled
[2017-12-22T17:10:33+00:00] INFO: Processing service[cluster] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:33+00:00] INFO: Chef Run complete in 12.303429835 seconds
[2017-12-22T17:10:33+00:00] INFO: Running report handlers
[2017-12-22T17:10:33+00:00] INFO: Report handlers complete
Enrolled in cluster "dev", members:
  cdemo_conjur_node_3
  cdemo_conjur_node_2
  cdemo_conjur_node_1
[2017-12-22T17:10:35+00:00] INFO: *** Chef 10.34.6 ***
[2017-12-22T17:10:35+00:00] WARN: Run List override has been provided.
[2017-12-22T17:10:35+00:00] WARN: Original Run List: []
[2017-12-22T17:10:35+00:00] WARN: Overridden Run List: [recipe[conjur::cluster]]
[2017-12-22T17:10:35+00:00] INFO: Run List is [recipe[conjur::cluster]]
[2017-12-22T17:10:35+00:00] INFO: Run List expands to [conjur::cluster]
[2017-12-22T17:10:35+00:00] INFO: Starting Chef Run for a263e40bff34
[2017-12-22T17:10:35+00:00] INFO: Running start handlers
[2017-12-22T17:10:35+00:00] INFO: Start handlers complete.
[2017-12-22T17:10:35+00:00] WARN: Cloning resource attributes for service[etcd-proxy] from prior resource (CHEF-3694)
[2017-12-22T17:10:35+00:00] WARN: Previous service[etcd-proxy]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:35+00:00] WARN: Current  service[etcd-proxy]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:35+00:00] WARN: Cloning resource attributes for service[etcd] from prior resource (CHEF-3694)
[2017-12-22T17:10:35+00:00] WARN: Previous service[etcd]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:35+00:00] WARN: Current  service[etcd]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:35+00:00] WARN: Cloning resource attributes for service[cluster] from prior resource (CHEF-3694)
[2017-12-22T17:10:35+00:00] WARN: Previous service[cluster]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:35+00:00] WARN: Current  service[cluster]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:35+00:00] INFO: Processing template[/opt/conjur/etc/conjur.conf] action create (conjur::_conjur_conf line 1)
[2017-12-22T17:10:35+00:00] INFO: template[/opt/conjur/etc/conjur.conf] backed up to /var/chef/backup/opt/conjur/etc/conjur.conf.chef-20171222171035
[2017-12-22T17:10:35+00:00] INFO: template[/opt/conjur/etc/conjur.conf] updated content
[2017-12-22T17:10:35+00:00] INFO: template[/opt/conjur/etc/conjur.conf] owner changed to 999
[2017-12-22T17:10:35+00:00] INFO: template[/opt/conjur/etc/conjur.conf] group changed to 999
[2017-12-22T17:10:35+00:00] INFO: template[/opt/conjur/etc/conjur.conf] mode changed to 644
[2017-12-22T17:10:35+00:00] INFO: Processing service[etcd-proxy] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:38+00:00] INFO: service[etcd-proxy] enabled
[2017-12-22T17:10:38+00:00] INFO: Processing service[etcd-proxy] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:38+00:00] INFO: Processing service[etcd] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:43+00:00] INFO: service[etcd] enabled
[2017-12-22T17:10:43+00:00] INFO: Processing service[etcd] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:43+00:00] INFO: Processing service[cluster] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:48+00:00] INFO: service[cluster] enabled
[2017-12-22T17:10:48+00:00] INFO: Processing service[cluster] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:48+00:00] INFO: Chef Run complete in 12.801079398 seconds
[2017-12-22T17:10:48+00:00] INFO: Running report handlers
[2017-12-22T17:10:48+00:00] INFO: Report handlers complete
Enrolled in cluster "dev", members:
  cdemo_conjur_node_3
  cdemo_conjur_node_2
  cdemo_conjur_node_1
[2017-12-22T17:10:50+00:00] INFO: *** Chef 10.34.6 ***
[2017-12-22T17:10:51+00:00] WARN: Run List override has been provided.
[2017-12-22T17:10:51+00:00] WARN: Original Run List: []
[2017-12-22T17:10:51+00:00] WARN: Overridden Run List: [recipe[conjur::cluster]]
[2017-12-22T17:10:51+00:00] INFO: Run List is [recipe[conjur::cluster]]
[2017-12-22T17:10:51+00:00] INFO: Run List expands to [conjur::cluster]
[2017-12-22T17:10:51+00:00] INFO: Starting Chef Run for 0dabb6a4379a
[2017-12-22T17:10:51+00:00] INFO: Running start handlers
[2017-12-22T17:10:51+00:00] INFO: Start handlers complete.
[2017-12-22T17:10:51+00:00] WARN: Cloning resource attributes for service[etcd-proxy] from prior resource (CHEF-3694)
[2017-12-22T17:10:51+00:00] WARN: Previous service[etcd-proxy]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:51+00:00] WARN: Current  service[etcd-proxy]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:51+00:00] WARN: Cloning resource attributes for service[etcd] from prior resource (CHEF-3694)
[2017-12-22T17:10:51+00:00] WARN: Previous service[etcd]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:51+00:00] WARN: Current  service[etcd]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:51+00:00] WARN: Cloning resource attributes for service[cluster] from prior resource (CHEF-3694)
[2017-12-22T17:10:51+00:00] WARN: Previous service[cluster]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:3:in `block in from_file'
[2017-12-22T17:10:51+00:00] WARN: Current  service[cluster]: /var/chef/cookbooks/conjur/recipes/_cluster_service.rb:7:in `block in from_file'
[2017-12-22T17:10:51+00:00] INFO: Processing template[/opt/conjur/etc/conjur.conf] action create (conjur::_conjur_conf line 1)
[2017-12-22T17:10:51+00:00] INFO: template[/opt/conjur/etc/conjur.conf] backed up to /var/chef/backup/opt/conjur/etc/conjur.conf.chef-20171222171051
[2017-12-22T17:10:51+00:00] INFO: template[/opt/conjur/etc/conjur.conf] updated content
[2017-12-22T17:10:51+00:00] INFO: template[/opt/conjur/etc/conjur.conf] owner changed to 999
[2017-12-22T17:10:51+00:00] INFO: template[/opt/conjur/etc/conjur.conf] group changed to 999
[2017-12-22T17:10:51+00:00] INFO: template[/opt/conjur/etc/conjur.conf] mode changed to 644
[2017-12-22T17:10:51+00:00] INFO: Processing service[etcd-proxy] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:53+00:00] INFO: service[etcd-proxy] enabled
[2017-12-22T17:10:53+00:00] INFO: Processing service[etcd-proxy] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:53+00:00] INFO: Processing service[etcd] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:10:58+00:00] INFO: service[etcd] enabled
[2017-12-22T17:10:58+00:00] INFO: Processing service[etcd] action start (conjur::_cluster_service line 7)
[2017-12-22T17:10:58+00:00] INFO: Processing service[cluster] action enable (conjur::_cluster_service line 3)
[2017-12-22T17:11:03+00:00] INFO: service[cluster] enabled
[2017-12-22T17:11:03+00:00] INFO: Processing service[cluster] action start (conjur::_cluster_service line 7)
[2017-12-22T17:11:03+00:00] INFO: Chef Run complete in 12.814428459 seconds
[2017-12-22T17:11:03+00:00] INFO: Running report handlers
[2017-12-22T17:11:03+00:00] INFO: Report handlers complete
Enrolled in cluster "dev", members:
  cdemo_conjur_node_3
  cdemo_conjur_node_2
  cdemo_conjur_node_1

-----
Killing current master...
Stopping: cdemo_conjur_node_1
Removing: cdemo_conjur_node_1

-----
Waiting for standby to be promoted to master...
~/Conjur/cdemo/cluster >> cd ..
~/Conjur/cdemo >> ./inspect-cluster.sh 


Load balancer config:
----------------
# This file is generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc.
global
	maxconn 256
	external-check

defaults
	timeout connect 5000ms
	timeout client 50000ms
	timeout server 50000ms

frontend f_conjur_master_http
	mode tcp
	bind *:443
	default_backend b_conjur_master_http

frontend f_conjur_master_pg
	mode tcp
	bind *:5432
	default_backend b_conjur_master_pg

frontend f_conjur_master_ldap
	mode tcp
	bind *:636
	default_backend b_conjur_master_ldap

# HTTP backend info 
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc
backend b_conjur_master_http
	mode tcp
	balance static-rr
	option external-check
	default-server inter 5s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server cdemo_conjur_node_3 172.18.0.8:443 check
	 server cdemo_conjur_node_2 172.18.0.7:443 check
	 server cdemo_conjur_node_1 172.18.0.2:443 check

# PG backend info
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc
backend b_conjur_master_pg
	mode tcp
	balance static-rr
	option external-check
	default-server inter 5s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server cdemo_conjur_node_3 172.18.0.8:5432 check
	 server cdemo_conjur_node_2 172.18.0.7:5432 check
	 server cdemo_conjur_node_1 172.18.0.2:5432 check

# LDAP backend info 
# Generated by ./update_haproxy.sh in /Users/josephhunt/Conjur/cdemo/etc
backend b_conjur_master_ldap
	mode tcp
	balance static-rr
	option external-check
	default-server inter 30s fall 3 rise 2
	external-check path "/usr/bin:/usr/local/bin"
	external-check command "/root/conjur-health-check.sh"
	 server cdemo_conjur_node_3 172.18.0.8:636 check
	 server cdemo_conjur_node_2 172.18.0.7:636 check
	 server cdemo_conjur_node_1 172.18.0.2:636 check


Running containers:
----------------
cdemo_conjur_node_3		Up 15 minutes
cdemo_conjur_node_2		Up 15 minutes
cdemo_scope_1		Up 15 minutes
conjur_follower		Up 17 minutes
cdemo_cli_1		Up 18 minutes
conjur_master		Up 13 minutes
artifacturlweb_app_1		Up 3 hours


Stateful node info:
----------------
cdemo_conjur_node_3, standby, 172.18.0.8
cdemo_conjur_node_2, standby, 172.18.0.7


~/Conjur/cdemo >> cat cdemo_conjur_node_2:/var/log/cluster.log
cat: cdemo_conjur_node_2:/var/log/cluster.log: No such file or directory
~/Conjur/cdemo >> docker exec cdemo_conjur_node_2 cat /var/log/cluster.log
Dec 22 17:40:30 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:40:31 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:42:31 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:42:32 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:44:33 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:44:33 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:46:34 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:46:34 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...
Dec 22 17:48:35 949af8fb8d22 evoke-cluster: etcd version not available (Request Timeout). Waiting 5 seconds...


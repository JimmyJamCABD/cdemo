---
- !policy
  id: shared_secret_auth
  body:
    - !host secret_rotator

    - &variables 
      - !variable helloworld_secret
      - !variable database_password
      - !variable web_config_password
      - !variable systema_root_sshkey
      - !variable systemb_root_sshkey
      - !variable aws_access_key
      - !variable aws_secret_key

    - !permit
      role: !host secret_rotator
      privileges:
        - read
        - update
      resource: *variables 

- !policy
  id: tomcat
  body:
    - !layer hosts
    - !host-factory
      layers: [ !layer hosts ]

- !policy
  id: webapp
  body:
    - !layer hosts
    - !host-factory
      layers: [ !layer hosts ]

- !policy
  id: jenkins
  body:
    - !layer hosts
    - !host-factory
      layers: [ !layer hosts ]

- !permit
  role: !layer webapp/hosts
  privileges:
    - read
    - execute
  resource: *variables
  
- !permit
  role: !layer tomcat/hosts
  privileges:
    - read
    - execute
  resource: *variables

- !permit
  role: !layer jenkins/hosts
  privileges:
    - read
    - execute
    - update
  resource: *variables

- !user bob

- !user dylan

- !user chris

- !user andy

- !group devops

- !group admins

- !grant
  role: !group devops
  members:
   - !user bob
   - !user dylan

- !grant
  role: !group admins
  members:
   - !user chris
   - !user andy

- !permit
  role: !group devops
  privileges:
   - read
   - execute

- !permit
  role: !group admins
  privileges:
   - read
   - execute
   - update
